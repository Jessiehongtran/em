<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="../css/index.css" />
        <link rel="stylesheet" href="../css/rounds.css" />
    </head>
    <body>
        <div class="container">
            <div class="wrapper">
                <div class="navigation">
                    <div class="logo-container">
                        <img src="../assets/images/mom&kid.png" class="logo" />
                        <h1 class="logo-text">Em</h1>
                    </div>
                    <ul class="nav-items">
                        <li class="each-nav-item">
                            <a href="round_tables.html">Round Tables</a>
                        </li>
                        <li class="each-nav-item">
                            <a href="stories.html?type=empathy">Empathy</a>
                        </li>
                        <li class="each-nav-item">
                            <a href="stories.html?type=vulnerability">Vulnerability</a>
                        </li>
                    </ul>
                </div>
                <div class="rounds-container">
                    <div class="sub-top">
                        <h4 class="sub-title">Coming soon</h4>
                        <a class="round-create-btn" href="new_round.html">
                            Create new round
                        </a>
                    </div>
                    <div class="round-highlight">
                    </div>
                    <h4 class="sub-title">Upcoming</h4>
                    <div class="round-list">
                    </div>
                </div>
            </div>
        </div>
        <script type="module">
            console.log('loading');
            import { rounds } from '../js/rounds.js';
            import { users } from '../js/users.js';

            let new_round = window.localStorage.getItem('new_round');
            if (new_round) {
                new_round = JSON.parse(new_round);
                rounds.push(new_round);
            }

            function findUser(userId) {
                for (let i = 0; i < users.length; i++) {
                    if (users[i].user_id === userId) {
                        return users[i]
                    }
                }
            }

            const roundList = document.getElementsByClassName('round-list')[0];
            const roundHighlight = document.getElementsByClassName('round-highlight')[0];

            const randomInd = Math.floor(Math.random()*rounds.length);
            const highlight = rounds[randomInd];

            for (let i = 0; i < rounds.length; i++) {
                const eachRound = document.createElement('div');
                eachRound.setAttribute('class', 'each-round');

                const leftRound = document.createElement('div');
                leftRound.innerHTML = "#" + rounds[i].num;
                eachRound.appendChild(leftRound);

                if (rounds[i].num === highlight.num) {
                    roundHighlight.appendChild(eachRound);
                    leftRound.setAttribute('class', 'big-left');
                } else {
                    roundList.appendChild(eachRound);
                    leftRound.setAttribute('class', 'left');
                }

                const rightRound = document.createElement('div');
                rightRound.setAttribute('class', 'right');
                eachRound.appendChild(rightRound);

                const title = document.createElement('h3');
                title.setAttribute('class', 'title');
                title.innerHTML = rounds[i].title;
                rightRound.appendChild(title);

                const description = document.createElement('p');
                description.setAttribute('class', 'description');
                description.innerHTML = rounds[i].description;
                rightRound.appendChild(description);

                const time = document.createElement('p');
                time.setAttribute('class', 'time');
                time.innerHTML = rounds[i].time;
                rightRound.appendChild(time);

                const participants = document.createElement('div');
                participants.setAttribute('class', 'participants');
                rightRound.appendChild(participants);

                for (let j = 0; j < rounds[i].participants.length; j++) {
                    const eachUser = document.createElement('img');
                    eachUser.setAttribute('class', 'each-participant');
                    eachUser.src = findUser(rounds[i].participants[j].user_id).profile_picture;
                    participants.appendChild(eachUser);
                }


            }
        </script>
    </body>
</html>